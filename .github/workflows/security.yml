name: LLM Endpoint Security Testing

on:
  workflow_dispatch:

jobs:
  llm-pentest:
    uses: tonyAllTrue/musical-dollop/.github/workflows/public-pentest.yml@main   # always pull latest main
    with:
      enable-llm-pentest: true
      enable-model-scanning: true
      inventory-scope: 'organization'
      fail-outcome-at-or-above: 'moderate'
      on-threshold-action: 'issue'
      source-ref: main
      pentest-template: 'DAN Only'
      model-scan-policies: 'model-scan-code-execution-prohibited,model-scan-input-output-operations-prohibited,model-scan-network-access-prohibited,model-scan-malware-signatures-prohibited'
      model-scan-description: 'CI/CD from Caller Workflow'
      on-hard-failures-action: 'ignore'
      github-repository: ${{ github.repository }}
      github-default-labels: 'goodmaster'
      github-assignees: 'TonyPurple'
      category-issue-min-severity: 'LOW'
      python-version: '3.11'
      artifact-retention-days: 30
      max-concurrent-pentests: 24
      start-stagger-secs: 3
      max-start-retries: 3
      start-retry-delay: 30
      poll-timeout-secs: 4200
      poll-timeout-action: partial
      graphql-extended-timeout-secs: 1800
      graphql-poll-interval-secs: 120
    secrets:
      ALLTRUE_API_KEY: ${{ secrets.ALLTRUE_API_KEY }}
      ALLTRUE_API_URL: ${{ vars.ALLTRUE_API_URL }}
      ALLTRUE_CUSTOMER_ID: ${{ vars.ALLTRUE_CUSTOMER_ID }}
      ALLTRUE_ORGANIZATION_ID: ${{ vars.ALLTRUE_ORGANIZATION_ID }}
      GH_TOKEN: ${{ secrets.GH_TOKEN }}

